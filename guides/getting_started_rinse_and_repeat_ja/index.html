<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Getting Started: Rinse and Repeat &#183; Arquillian Guides</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="スタートガイドのパート２です。もう少し複雑な例を通じて、理解を確認し、リモートのコンテナをどのように使うか学びます。" name="description" />
    <link href="/blog/atom.xml" rel="alternate" title="Arquillian blog Atom feed" type="application/atom+xml" />
    <link href="/stylesheets/screen.css?4c52ec076c01fb86281d08146616aec64ec1e569" rel="stylesheet" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/r29/html5.js"></script>
    <![endif]-->
    <link href="/favicon.ico" rel="shortcut icon" />
  </head>
  <body class="guide">
    <header class="navbar navbar-fixed-top" id="banner" role="banner">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/">
            <span class="logo"></span>
            <span class="name">Arquillian</span>
          </a>
          <nav class="nav-collapse" role="navigation">
            <ul class="nav">
              <li><a href="/invasion/">Invasion!</a></li>
              <li><a href="/features/">Features</a></li>
              <li class="active"><a href="/guides/">Guides</a></li>
              <li><a href="/blog/">Blog</a></li>
              <li><a href="/community/">Community</a></li>
              <li><a href="/code/">Code</a></li>
            </ul>
          </nav>
        </div>
      </div>
    </header>
    <div id="main" role="main">
      <div id="content-header">
        <div class="container">
          <div class="headline">
            <h1>
              <a href="/guides/">Arquillian Guides</a>
              <small>Designed exclusively to teach you how to use Arquillian to write real tests.</small>
            </h1>
            <div class="directory">
              <a class="guides_menu" href="./" id="guides_menu">
                Guides Index
                <i class="icon-menu-closed"></i>
              </a>
              <div id="guides" style="display: none">
                <a class="guides_menu" href="./">
                  Guides Index
                  <i class="icon-menu-open"></i>
                </a>
                <hr class="clear" />
                <dl class="beg">
                  <dt>First Steps</dt>
                  <dd><a href="/guides/getting_started/">Getting Started</a>
                  <br />
                  <a href="/guides/getting_started/"><img class="flag" rel="tooltip" src="/images/flags/en.png" title="English (en)" /></a>
                  <a href="/guides/getting_started_de/"><img class="flag" rel="tooltip" src="/images/flags/de.png" title="Deutsch (de)" /></a>
                  <a href="/guides/getting_started_es/"><img class="flag" rel="tooltip" src="/images/flags/es.png" title="Español (es)" /></a>
                  <a href="/guides/getting_started_fr/"><img class="flag" rel="tooltip" src="/images/flags/fr.png" title="Française (fr)" /></a>
                  <a href="/guides/getting_started_ja/"><img class="flag" rel="tooltip" src="/images/flags/ja.png" title="日本 (ja)" /></a>
                  <a href="/guides/getting_started_nl/"><img class="flag" rel="tooltip" src="/images/flags/nl.png" title="Nederlands (nl)" /></a>
                  <a href="/guides/getting_started_pl/"><img class="flag" rel="tooltip" src="/images/flags/pl.png" title="Polski (pl)" /></a>
                  <a href="/guides/getting_started_pt/"><img class="flag" rel="tooltip" src="/images/flags/pt.png" title="Português (pt)" /></a>
                  <a href="/guides/getting_started_sv_se/"><img class="flag" rel="tooltip" src="/images/flags/sv_se.png" title="Svenska (sv_se)" /></a>
                  <a href="/guides/getting_started_zh_cn/"><img class="flag" rel="tooltip" src="/images/flags/zh_cn.png" title="简体中文 (zh_cn)" /></a></dd>
                  <dd><a href="/guides/getting_started_rinse_and_repeat/">Getting Started: Rinse and Repeat</a>
                  <br />
                  <a href="/guides/getting_started_rinse_and_repeat/"><img class="flag" rel="tooltip" src="/images/flags/en.png" title="English (en)" /></a>
                  <a href="/guides/getting_started_rinse_and_repeat_ja/"><img class="flag" rel="tooltip" src="/images/flags/ja.png" title="日本 (ja)" /></a>
                  <a href="/guides/getting_started_rinse_and_repeat_zh_cn/"><img class="flag" rel="tooltip" src="/images/flags/zh_cn.png" title="简体中文 (zh_cn)" /></a></dd>
                  <dd><a href="/guides/get_started_faster_with_forge/">Get Started Faster with Forge</a>
                  <br />
                  <a href="/guides/get_started_faster_with_forge/"><img class="flag" rel="tooltip" src="/images/flags/en.png" title="English (en)" /></a>
                  <a href="/guides/get_started_faster_with_forge_ja/"><img class="flag" rel="tooltip" src="/images/flags/ja.png" title="日本 (ja)" /></a>
                  <a href="/guides/get_started_faster_with_forge_zh_cn/"><img class="flag" rel="tooltip" src="/images/flags/zh_cn.png" title="简体中文 (zh_cn)" /></a></dd>
                  <dd><a href="/guides/shrinkwrap_introduction/">Creating Deployable Archives with ShrinkWrap</a></dd>
                </dl>
                <dl class="int">
                  <dt>More Coverage</dt>
                  <dd><a href="/guides/testing_java_persistence/">Testing Java Persistence</a></dd>
                  <dd><a href="/guides/functional_testing_using_drone/">Functional Testing using Drone</a></dd>
                </dl>
                <dl class="adv">
                  <dt>Enhance</dt>
                  <dd><a href="/guides/testing_in_the_cloud/">Testing in the Cloud</a></dd>
                </dl>
                <dl class="ref">
                  <dt>Reference</dt>
                  <dd><a href="https://docs.jboss.org/author/display/ARQ/Reference+Guide">Reference Guide</a></dd>
                  <dd><a href="http://docs.jboss.org/arquillian/api/latest">API Docs</a>,
                  <a href="http://docs.jboss.org/arquillian/spi/latest">SPI Docs</a></dd>
                  <dd><a href="http://community.jboss.org/wiki/ArquillianMigrationGuides">Migration Guides</a></dd>
                  <dd><a href="http://community.jboss.org/en/arquillian/faq">FAQs</a></dd>
                </dl>
              </div>
            </div>
            <script>$(function() { activateGuideMenuControl() })</script>
          </div>
        </div>
      </div>
      <div class="container" id="guide">
        <div id="content" lang="ja">
            <div class="header">
            <h2>Getting Started: Rinse and Repeat</h2>
            <div class="authors"><strong>Author:</strong>
           <a href="https://community.jboss.org/people/dan.j.allen">Dan Allen</a>
          <strong style="padding-left: 10px;">Translator:</strong>
           <a href="https://community.jboss.org/people/tkonishi">Takayuki Konishi</a>
          <strong style="padding-left: 10px;">Language:</strong>
          <img class="flag" rel="tooltip" src="/images/flags/ja.png" title="日本 (ja)" />
          <br />
          <strong>Level:</strong>
           First Steps
          <strong style="padding-left: 10px;">Last Update:</strong> Apr 05, 2012</div>
            <p>この <a href="/guides/getting_started">Getting Started</a> ガイドの続編では、少し複雑な例を通じて、Arquillianについて何を学んだかを確認できます。このガイドを読むと、以下のことができるようになります：</p>
            <ul>
          	<li><acronym title="Contexts and Dependency Injection">CDI</acronym>とEJB(Enterprise JavaBeans)を含むArquillianのテストを書く</li>
          	<li>Arquillianのテストをリモートのコンテナ(つまり、サーバー)で実行する</li>
          	<li>Arquillianのテストをリモートのコンテナ内でデバッグする</li>
          </ul>
            <p>読者は、追加のプロファイルを有効にした際、Arquillianがリモートのコンテナ（つまり、サーバー）でテストを実行するためのビルドに組み込むことにより、これらの技術を学びます。これは、 <em>本物</em> でのテストを意味します。モックではありません。組み込みのランタイムではありません！読者は、最初のガイドでもっとも厳しい作業は行っており、理解するまでさほど時間はかからないでしょう。</p>
            </div>
            <h3 id="&#21069;&#25552;">前提</h3>
          <p>このガイドは、読者がArquillianインフラストラクチャをテストスイートに追加済みで、少なくとも1つのをArquillianテストを書きいたことがあることを前提としています。これらがまだであれば、Arquillianの基本に親しむために <a href="/guides/getting_started">Getting Started</a> を読んでください。また、そのガイド内で必須となっているソフトウェアも必要です。</p>
          <h3 id="&#12467;&#12531;&#12509;&#12540;&#12493;&#12531;&#12488;&#12434;&#20316;&#25104;&#12377;&#12427;">コンポーネントを作成する</h3>
          <p>このガイドでは、とても基本的なショッピングアプリケーションのバックエンドを作成します。訪問者が選んだ品物を保存するためにbasketコンポーネントを使い、確定した注文を保存し読み出すためにorder repositoryコンポーネントを使います。ここでは、それぞれをCDIとEJBを使って実装します。すでにJava EE 6 APIがクラスパス上にあるので、すぐにこれら二つのプログラミングモデルを利用して始めることができます（このAPIをプロジェクトに導入する手順は、 <a href="/guides/getting_started">Getting Started</a> ガイドを参照してください）。</p>
          <p>オーダーを永続的なストレージとやりとりするコンポーネントから始めましょう。よいソフトウェア設計に従い、またテストをシンプルにするために、契約を表すインターフェースの設計から始めます。IDEで、新しく <code>OrderRepository</code> というローカルEJBインターフェースを作成し、以下のコンテンツを追加してください。</p>
          <div class="filename">src/main/java/org/arquillian/example/OrderRepository.java</div>
          <pre class="prettify"><code class="prettify">package org.arquillian.example;</code>&#x000A;&#x000A;<code class="prettify">import java.util.List;&#x000A;import javax.ejb.Local;</code>&#x000A;&#x000A;<code class="prettify">@Local&#x000A;public interface OrderRepository {&#x000A;    void addOrder(List&lt;String&gt; order);&#x000A;    List&lt;List&lt;String&gt;&gt; getOrders();&#x000A;    int getOrderCount();&#x000A;}</code></pre>
          <p>実装について気にするのは、ちょっと後にして、ここでは、この契約をどのように利用するか考えましょう。</p>
          <p>訪問者がこのサイトを訪れたとき、買い物かごに品物を入れてから購入するでしょう。このシナリオをモデル化するために、訪問者のHTTPセッションに関連したCDI beanを使います。訪問者が選んだ品物を購入するときに、このコンポーネントは、 <code>OrderRepository</code> EJBに移譲します。</p>
          <p>IDEで、 <code>Basket</code> というクラスを作成し、次に示すように <code>@SessionScoped</code> スコープアノテーションを追加して、セッションコンテキストに割り当ててください。</p>
          <div class="filename">src/main/java/org/arquillian/example/Basket.java</div>
          <pre class="prettify"><code class="prettify">package org.arquillian.example;</code>&#x000A;&#x000A;<code class="prettify">import java.io.Serializable;&#x000A;import java.util.ArrayList;&#x000A;import java.util.Collections;&#x000A;import java.util.List;</code>&#x000A;&#x000A;<code class="prettify">import javax.annotation.PostConstruct;&#x000A;import javax.ejb.EJB;&#x000A;import javax.enterprise.context.SessionScoped;</code>&#x000A;&#x000A;<code class="prettify">@SessionScoped&#x000A;public class Basket implements Serializable {&#x000A;    private static final long serialVersionUID = 1L;&#x000A;    private List&lt;String&gt; items;</code>&#x000A;    &#x000A;<code class="prettify">    @EJB&#x000A;    private OrderRepository repo;</code>&#x000A;    &#x000A;<code class="prettify">    public void addItem(String item) {&#x000A;        items.add(item);&#x000A;    }</code>&#x000A;    &#x000A;<code class="prettify">    public List&lt;String&gt; getItems() {&#x000A;        return Collections.unmodifiableList(items);&#x000A;    }</code>&#x000A;    &#x000A;<code class="prettify">    public int getItemCount() {&#x000A;        return items.size();&#x000A;    }</code>&#x000A;    &#x000A;<code class="prettify">    public void placeOrder() {&#x000A;        repo.addOrder(items);&#x000A;        items.clear();&#x000A;    }</code>&#x000A;    &#x000A;<code class="prettify">    @PostConstruct&#x000A;    void initialize() {&#x000A;        items = new ArrayList&lt;String&gt;();&#x000A;    }&#x000A;}</code></pre>
          <p>ご覧のようにEJBをCDI beanに接合しました。まさにテストしたいと考えている結合です！</p>
          <h3 id="&#27573;&#38542;&#30340;&#12395;&#23455;&#35013;&#12377;&#12427;">段階的に実装する</h3>
          <p>まだまだテストを書く準備ができていません。それは <code>OrderRepository</code> の実装がないからです。この例の目的のために、 <code>OrderRepository</code> は、他のチーム（または別のイテレーション）の実装があると仮定しましょう。ここが、Arquillianのマイクロデプロイメント機能が本当に引き立つところです。EJBシングルトンとして、インメモリ実装を作成し、テストアーカイブにまとめて、動作するアプリケーションを短期間で手に入れることができます（この実装を、この境界でのテストのために残すと決めてしまうかもしれません）。</p>
          <p><code>SingletonOrderRepository</code> クラスをテストクラスパス内に作成し、以下のコードを追加してください。</p>
          <div class="filename">src/test/java/org/arquillian/example/SingletonOrderRepository.java</div>
          <pre class="prettify"><code class="prettify">package org.arquillian.example;</code>&#x000A;&#x000A;<code class="prettify">import java.util.ArrayList;&#x000A;import java.util.Collections;&#x000A;import java.util.List;</code>&#x000A;&#x000A;<code class="prettify">import javax.annotation.PostConstruct;&#x000A;import javax.ejb.Lock;&#x000A;import javax.ejb.LockType;&#x000A;import javax.ejb.Singleton;</code>&#x000A;&#x000A;<code class="prettify">@Singleton&#x000A;@Lock(LockType.READ)&#x000A;public class SingletonOrderRepository implements OrderRepository {&#x000A;    private List&lt;List&lt;String&gt;&gt; orders;</code>&#x000A;    &#x000A;<code class="prettify">    @Override&#x000A;    @Lock(LockType.WRITE)&#x000A;    public void addOrder(List&lt;String&gt; order) {&#x000A;        orders.add(order);&#x000A;    }</code>&#x000A;    &#x000A;<code class="prettify">    @Override&#x000A;    public List&lt;List&lt;String&gt;&gt; getOrders() {&#x000A;        return Collections.unmodifiableList(orders);&#x000A;    }</code>&#x000A;    &#x000A;<code class="prettify">    @Override&#x000A;    public int getOrderCount() {&#x000A;        return orders.size();&#x000A;    }</code>&#x000A;    &#x000A;<code class="prettify">    @PostConstruct&#x000A;    void initialize() {&#x000A;        orders = new ArrayList&lt;List&lt;String&gt;&gt;();&#x000A;    }&#x000A;}</code></pre>
          <p>この実装にはおまけが追加されており、それはArquillianのサンドボックスの中で、EJB 3.1の新しいシングルトン機能で遊んでみる機会です。そんなわけで、筆者は、Arquillianはテストツールに加えて学習環境である、と言っています。</p>
          <p>Arquillianテストを書く準備ができました。</p>
          <h3 id="&#12486;&#12473;&#12488;&#12434;&#26360;&#12367;">テストを書く</h3>
          <p>ここでは、 <code>Basket</code> インスタンスへのアイテム追加を模倣し、そのインスタンスをあるオーダーに入れ、そのオーダーが処理され、一つの <code>OrderRepository</code> インスタンスにストアされることを検証する テストを書こうとしています。</p>
          <p class="info"><span>いうまでもなく、ここでは、ただメモリ上での実装をテストします。データベースを使うテストをどのように書くかは、 <a href="/guides/testing_java_persistence">Testing Java Persistence</a> ガイドで学びます。</span></p>
          <p><code>BasketTest</code> クラスを作成し、Arquillianテストケースとして初期化します：</p>
          <div class="filename">src/test/java/org/arquillian/example/BasketTest.java</div>
          <pre class="prettify"><code class="prettify">package org.arquillian.example;</code>&#x000A;&#x000A;<code class="prettify">import org.jboss.arquillian.junit.Arquillian;</code>&#x000A;&#x000A;<code class="prettify">@RunWith(Arquillian.class)&#x000A;public class BasketTest {&#x000A;}</code></pre>
          <p>次に、basket、order repositoryインターフェースとそのシングルトン実装を含むテストアーカイブを定義します。また、CDIを有効にするため、空のbeans.xmlが必要です（EJBは自動的に有効化されます）。アーカイブに何を入れるかを厳密に定義することにより、いかにクラスパス以上に完全なコントールができているか、ということに注目してください。</p>
          <div class="filename">src/test/java/org/arquillian/example/BasketTest.java</div>
          <pre class="prettify"><code class="prettify">package org.arquillian.example;</code>&#x000A;&#x000A;<code class="prettify">import org.jboss.arquillian.container.test.api.Deployment;&#x000A;import org.jboss.arquillian.junit.Arquillian;&#x000A;import org.jboss.shrinkwrap.api.ShrinkWrap;&#x000A;import org.jboss.shrinkwrap.api.asset.EmptyAsset;&#x000A;import org.jboss.shrinkwrap.api.spec.JavaArchive;</code>&#x000A;&#x000A;<code class="prettify">@RunWith(Arquillian.class)&#x000A;public class BasketTest {&#x000A;    @Deployment&#x000A;    public static JavaArchive createDeployment() {&#x000A;        return ShrinkWrap.create(JavaArchive.class, "test.jar")&#x000A;            .addClasses(Basket.class, OrderRepository.class, SingletonOrderRepository.class)&#x000A;            .addAsManifestResource(EmptyAsset.INSTANCE, "beans.xml");&#x000A;    }&#x000A;}</code></pre>
          <p>残りは、basketとorder repositoryを注入することと、それらのインタラクションをテストすることです。EJBは、実装ではなくインターフェースを注入します。EJBコンテナは、自動的にそのインターフェースで使用するEJB実装を見つけます。</p>
          <div class="filename">src/test/java/org/arquillian/example/BasketTest.java</div>
          <pre class="prettify"><code class="prettify">package org.arquillian.example;</code>&#x000A;&#x000A;<code class="prettify">import javax.ejb.EJB;&#x000A;import javax.inject.Inject;</code>&#x000A;&#x000A;<code class="prettify">import org.jboss.arquillian.container.test.api.Deployment;&#x000A;import org.jboss.arquillian.junit.Arquillian;&#x000A;import org.jboss.shrinkwrap.api.ShrinkWrap;&#x000A;import org.jboss.shrinkwrap.api.asset.EmptyAsset;&#x000A;import org.jboss.shrinkwrap.api.spec.JavaArchive;&#x000A;import org.junit.Assert;&#x000A;import org.junit.Test;&#x000A;import org.junit.runner.RunWith;</code>&#x000A;&#x000A;<code class="prettify">@RunWith(Arquillian.class)&#x000A;public class BasketTest {&#x000A;    @Deployment&#x000A;    public static JavaArchive createDeployment() {&#x000A;        return ShrinkWrap.create(JavaArchive.class, "test.jar")&#x000A;            .addClasses(Basket.class, OrderRepository.class, SingletonOrderRepository.class)&#x000A;            .addAsManifestResource(EmptyAsset.INSTANCE, "beans.xml");&#x000A;    }</code>&#x000A;    &#x000A;<code class="prettify">    @Inject&#x000A;    Basket basket;</code>&#x000A;    &#x000A;<code class="prettify">    @EJB&#x000A;    OrderRepository repo;</code>&#x000A;    &#x000A;<code class="prettify">    @Test&#x000A;    public void place_order_should_add_order() {&#x000A;        basket.addItem("sunglasses");&#x000A;        basket.addItem("suit");&#x000A;        basket.placeOrder();&#x000A;        Assert.assertEquals(1, repo.getOrderCount());&#x000A;        Assert.assertEquals(0, basket.getItemCount());</code>&#x000A;        &#x000A;<code class="prettify">        basket.addItem("raygun");&#x000A;        basket.addItem("spaceship");&#x000A;        basket.placeOrder();&#x000A;        Assert.assertEquals(2, repo.getOrderCount());&#x000A;        Assert.assertEquals(0, basket.getItemCount());&#x000A;    }</code>&#x000A;    &#x000A;<code class="prettify">    @Test&#x000A;    public void order_should_be_persistent() {&#x000A;        Assert.assertEquals(2, repo.getOrderCount());&#x000A;    }&#x000A;}</code></pre>
          <p>テストを書きました。次に実行するためにセットアップしなければなりません。</p>
          <h3 id="&#12522;&#12514;&#12540;&#12488;&#12467;&#12531;&#12486;&#12490;&#12434;&#36861;&#21152;&#12377;&#12427;">リモートコンテナを追加する</h3>
          <p>このテストでは、CDIとEJBの両方を使用します。この組み合わせは、組み込みランタイム（たとえばWeld EmbeddedやOpenEJB Embedded）の限界を押し上げます。可能であったとしても、単純にJava EEコンテナを利用する方がシンプルです。それに加えて、より正確なテスト結果を得られます。それで、この後はWeld Embeddedコンテナから離れましょう。</p>
          <p>前のガイドで、embeddedとmanagedの両方のコンテナを使いました。両方のケースで、Arquillianは、テストスイート開始時にコンテナをスタートし、テストが終了すると停止しなければなりません。コンテナをすでにスタートしていた場合（あるいはテストのために起動したい場合）はどうでしょう？ これは、明らかにテストの実行には最速です。コンテナの起動が非常に速いとしても、セットアップが不要な場合にはかないません。これがリモートコンテナの目的です。</p>
          <p>リモートコンテナは、統合テストにおいて理想的な開発環境を提供します。また、とても直感的にデバッグができることに気づくでしょう。そして、テストにおいてコンテナへの参照がないので、開発時にリモートコンテナを使うと、継続的結合においてマネージドコンテナを利用する際に邪魔になりません。</p>
          <p class="warning"><span>リモートという用語は、異なるプロセスを意味します。他のマシンでも設定できますが、必ずしもその必要はありません。</span></p>
          <p>リモートコンテナは独立したプロセスで、Arquillianは、そのコンテナのクライアントのデプロイメントAPIを使用します。従って必要なライブラリは：</p>
          <ul>
          	<li>プログラミングモデルのAPI（コンテナが提供しない場合に限り、パッケージ化するために必要です）</li>
          	<li>Arquillianリモートコンテナアダプター</li>
          	<li>コンテナプロセスと通信するためのクライアントデプロイメントAPI</li>
          </ul>
          <p>Mavenのpom.xmlファイルの <code>&lt;profiles&gt;</code> 要素の下に、新しいプロファイルを2つ加えてください。最初のプロファイルは、リモートのJBoss AS 7コンテナを使用します：</p>
          <div class="filename">pom.xml</div>
          <pre class="prettify"><code class="prettify">&lt;!-- clip --&gt;&#x000A;&lt;profile&gt;&#x000A;    &lt;id&gt;arquillian-jbossas-remote&lt;/id&gt;&#x000A;    &lt;dependencies&gt;&#x000A;        &lt;dependency&gt;&#x000A;            &lt;groupId&gt;org.jboss.spec&lt;/groupId&gt;&#x000A;            &lt;artifactId&gt;jboss-javaee-6.0&lt;/artifactId&gt;&#x000A;            &lt;version&gt;1.0.0.Final&lt;/version&gt;&#x000A;            &lt;type&gt;pom&lt;/type&gt;&#x000A;            &lt;scope&gt;provided&lt;/scope&gt;&#x000A;        &lt;/dependency&gt;&#x000A;        &lt;dependency&gt;&#x000A;            &lt;groupId&gt;org.jboss.as&lt;/groupId&gt;&#x000A;            &lt;artifactId&gt;jboss-as-arquillian-container-remote&lt;/artifactId&gt;&#x000A;            &lt;version&gt;7.0.2.Final&lt;/version&gt;&#x000A;            &lt;scope&gt;test&lt;/scope&gt;&#x000A;        &lt;/dependency&gt;&#x000A;    &lt;/dependencies&gt;&#x000A;&lt;/profile&gt;&#x000A;&lt;!-- clip --&gt;</code></pre>
          <p>二番目のプロファイルは、リモートのGlassFish 3.1コンテナを使用します：</p>
          <div class="filename">pom.xml</div>
          <pre class="prettify"><code class="prettify">&lt;!-- clip --&gt;&#x000A;&lt;profile&gt;&#x000A;    &lt;id&gt;arquillian-glassfish-remote&lt;/id&gt;&#x000A;    &lt;dependencies&gt;&#x000A;        &lt;dependency&gt;&#x000A;            &lt;groupId&gt;org.jboss.spec&lt;/groupId&gt;&#x000A;            &lt;artifactId&gt;jboss-javaee-6.0&lt;/artifactId&gt;&#x000A;            &lt;version&gt;1.0.0.Final&lt;/version&gt;&#x000A;            &lt;type&gt;pom&lt;/type&gt;&#x000A;            &lt;scope&gt;provided&lt;/scope&gt;&#x000A;        &lt;/dependency&gt;&#x000A;        &lt;dependency&gt;&#x000A;            &lt;groupId&gt;org.jboss.weld&lt;/groupId&gt;&#x000A;            &lt;artifactId&gt;weld-api&lt;/artifactId&gt;&#x000A;            &lt;version&gt;1.0-SP1&lt;/version&gt;&#x000A;            &lt;scope&gt;test&lt;/scope&gt;&#x000A;            &lt;exclusions&gt;&#x000A;                &lt;exclusion&gt;&#x000A;                    &lt;groupId&gt;javax.enterprise&lt;/groupId&gt;&#x000A;                    &lt;artifactId&gt;cdi-api&lt;/artifactId&gt;&#x000A;                &lt;/exclusion&gt;&#x000A;            &lt;/exclusions&gt;&#x000A;        &lt;/dependency&gt;&#x000A;        &lt;dependency&gt;&#x000A;            &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;&#x000A;            &lt;artifactId&gt;jersey-bundle&lt;/artifactId&gt;&#x000A;            &lt;version&gt;1.6&lt;/version&gt;&#x000A;            &lt;scope&gt;test&lt;/scope&gt;&#x000A;            &lt;exclusions&gt;&#x000A;                &lt;exclusion&gt;&#x000A;                    &lt;groupId&gt;javax.ws.rs&lt;/groupId&gt;&#x000A;                    &lt;artifactId&gt;jsr311-api&lt;/artifactId&gt;&#x000A;                &lt;/exclusion&gt;&#x000A;            &lt;/exclusions&gt;&#x000A;        &lt;/dependency&gt;&#x000A;        &lt;dependency&gt;&#x000A;            &lt;groupId&gt;com.sun.jersey.contribs&lt;/groupId&gt;&#x000A;            &lt;artifactId&gt;jersey-multipart&lt;/artifactId&gt;&#x000A;            &lt;version&gt;1.6&lt;/version&gt;&#x000A;            &lt;scope&gt;test&lt;/scope&gt;&#x000A;        &lt;/dependency&gt;&#x000A;        &lt;dependency&gt;&#x000A;            &lt;groupId&gt;org.jboss.arquillian.container&lt;/groupId&gt;&#x000A;            &lt;artifactId&gt;arquillian-glassfish-remote-3.1&lt;/artifactId&gt;&#x000A;            &lt;version&gt;1.0.0.CR2&lt;/version&gt;&#x000A;            &lt;scope&gt;test&lt;/scope&gt;&#x000A;        &lt;/dependency&gt;&#x000A;    &lt;/dependencies&gt;&#x000A;&lt;/profile&gt;&#x000A;&lt;!-- clip --&gt;</code></pre>
          <p class="info"><span>リモートGlassFishアダプタは、コンテナとのJAX-<acronym title="REST">RS</acronym>を介した通信にJerseyを使っているため、追加のライブラリが必要になります。Weld APIは、コンテナプロセスから返される例外のアンマーシャリングが必要です。</span></p>
          <p>pom.xmlにプロファイルを追加してしまえば、Eclipseでプロジェクトを右クリックして、Maven &gt; Update Project Configrationを選択します。もしプロジェクトでコンパイルエラーが表示されたら、プロファイルのどれかを有効化してください。</p>
          <p>EclipseでMavenプロファイルを有効化する方法は2つあることを思い出してください：</p>
          <ol>
          	<li>手動で設定（標準的なやり方）</li>
          	<li>Maven profile selector (JBoss Tools)</li>
          </ol>
          <p>プロファイルを有効化する方法は、 <a href="/guides/getting_started#test_across_containers">Getting Started</a> を参照してください。一度有効化すれば、プロジェクトはきれいにコンパイルできるはずです。</p>
          <p>Arquillianは、コンテナが起動していると期待しています。従って、テストを実行する前に便利なIDEから起動できるように設定しましょう。</p>
          <h3 id="&#12469;&#12540;&#12496;&#12540;&#12434;&#21046;&#24481;&#12377;&#12427;">サーバーを制御する</h3>
          <p>リモートコンテナを管理する簡単な方法は、IDEで設定することです。もし読者がコマンドライン好きであれば、このステップは飛ばして、適当な起動スクリプトで起動することもできます。</p>
          <p>ここではEclipseに、サーバー（コンテナ）の設定の追加方法を説明します。このプロセスは、他のIDEでも同様です。Eclipseでは、 <a href="http://jboss.org/tools">JBoss Tools</a> とGlassFish Java EE Application Server Pluginが必要で、両方ともEclipse MarketPlaceから入手できます。</p>
          <p>Eclipseでは、メニューバーからWindow &gt; Show View &gt; Serversを選択してください。ビューを開いたら、右クリックして、New &gt; Serverを選択してください。一つはJBoss AS 7、もう一つはGlassFish 3.1を設定したいでしょう。JBoss AS 7については、ウィザードは読者がすでにダウンロード、展開したJBoss AS 7ランタイムが必要です。GlassFish 3.1ウィザードでは、ディストリビューションの自動ダウンロードも選択できます。</p>
          <p><img src="/images/guides/arquillian_tutorial_2_new_jbossas_server.png" alt="" /></p>
          <p><img src="/images/guides/arquillian_tutorial_2_new_glassfish_server.png" alt="" /></p>
          <p>それぞれのコンテナについてウィザードが完了したら、サーバービューに表示されます。</p>
          <p><img src="/images/guides/arquillian_tutorial_2_servers_view.png" alt="" /></p>
          <p>サーバーの起動は、（上の図に示すように）エントリを選択して、緑のプレイアイコンをクリックしてください。</p>
          <p class="info"><span>Arquillianは、コンテナがデフォルトポートでの実行を仮定しています。もし、ポートを変更していたら、arquillain.xmlにそれぞれのコンテナのポートを指定できます。</span></p>
          <p>さて、コンテナの準備ができたので、それらに向けてテストを実行するときです。</p>
          <h3 id="arquillian&#12486;&#12473;&#12488;&#12398;&#23455;&#34892;">Arquillianテストの実行</h3>
          <p>Arquillianテストを実行させるには、3つのステップを実行してください。</p>
          <ol>
          	<li>リモートコンテナを起動する</li>
          	<li>Mavenプロファイルを有効化し、対応するコンテナアダプタをクラスパスに追加する</li>
          	<li>テスト実行</li>
          </ol>
          <p>JBoss AS 7で実行してみましょう</p>
          <h4>JBoss AS上でテストを実行する</h4>
          <p>JBoss AS上でテストを実行するには、まずJBoss ASコンテナを起動します。サーバービューを開き、JBoss AS 7を選択し、緑のプレイボタンをクリックして、開始を待ちます（さほどかからないはずです）。</p>
          <p>起動したら、Mavenプロパティタブか、JBoss Tools Maven profile selectorで、 <code>arquillian-jbossas-remote</code> Mavenプロファイルを有効化します。下のプロファイルエディタは正しいプロファイルを選択したところです。</p>
          <p><img src="/images/guides/arquillian_tutorial_2_jbossas_profile_selection.png" alt="" /></p>
          <p>最後に、 <code>BasketTest</code> を右クリックし、Run As &gt; JUnit Testを選択します。コンソールビューでは、実行状況が流れ、成功との結果が、JUnitビューに表示されます。</p>
          <p>コマンドラインから、Mavenでテストを実行することもできます：</p>
          <pre class="command"><code class="command">$ mvn test -Parquillian-jbossas-remote -Dtest=BasketTest</code></pre>
          <p>コンソールに以下のように表示されるでしょう：</p>
          <pre class="output"><code class="output">-------------------------------------------------------&#x000A;T E S T S&#x000A;-------------------------------------------------------&#x000A;Running org.arquillian.example.BasketTest&#x000A;...&#x000A;Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 5.464 sec</code></pre>
          <p><strong>おめでとう！</strong> リモートコンテナを使ったArquillianの最初の <strong class="greenbar">グリーンバー</strong> が表示されました。</p>
          <p class="info"><span>EJBを <code>@EJB</code> ではなく、 <code>@Inject</code> でインジェクトすることもできます。試してみましょう！</span></p>
          <p>もし、シングルトンが実際に仕事をしているか検証したい場合は、 <code>SingletonOrderRepository</code> クラスから、 <code>@Singleton</code> アノテーションを削除して実行してください。テストでは、アサーションエラーが表示されるでしょう。元に戻すと、グリーンに戻ります。</p>
          <p>GlassFish 3.1上で、全く同じテストをしましょう。JBoss ASでのテストは済んだので、サーバービューでサーバーを終了します。</p>
          <h4>GlassFish上でテストを実行する</h4>
          <p>GlassFish上でテストを実効するには、GlassFishコンテナの起動から始めます。サーバービューを開き、GlassFish 3.1を選択し、緑のプレイアイコンをクリックして、開始を待ちます。</p>
          <p>起動したら、Mavenプロパティタブか、JBoss Tools Maven profile selectorで、 <code>arquillian-glassfish-remote</code> Mavenプロファイルを有効化します。 <code>arquillian-jbossas-remote</code> プロファイルの無効化を忘れないでください。以下のプロファイルエディタは正しいプロファイルを選択したところです。</p>
          <p><img src="/images/guides/arquillian_tutorial_2_glassfish_profile_selection.png" alt="" /></p>
          <p>最後に、 <code>BasketTest</code> を右クリックし、Run As &gt; JUnit Testを選択します。コンソールビューでは、実行状況が流れ、成功との結果が、JUnitビューに表示されます。</p>
          <p><strong>おめでとう！</strong> 二つめの <strong class="greenbar">グリーンバー</strong> です！</p>
          <h3 id="arquillian&#12486;&#12473;&#12488;&#12398;&#12487;&#12496;&#12483;&#12464;">Arquillianテストのデバッグ</h3>
          <p>リモートコンテナでテストをデバッグする？それは難しそうだ。そんなことはありません！上のステップを一つ変更し、一つ追加するだけです：</p>
          <ol>
          	<li>リモートコンテナを <strong>デバッグ</strong> する</li>
          	<li>Mavenプロファイルを有効化し、対応するコンテナアダプタをクラスパスに追加する</li>
          	<li><strong>ブレークポイントを設定する</strong></li>
          	<li>テスト実行</li>
          </ol>
          <p>サーバービューには、緑のプレイボタンの左にデバッグアイコンがあります。このボタンをクリックすると、デバッグモードでサーバーが起動します。Eclipseは自動的にそのコンテナにデバッガを接続します。</p>
          <p><code>SingletonOrderRepository</code> beanの <code>addOrder()</code> メソッドにブレークポイントを設定します。ここでまた右クリックとRun As &gt; JUnit Testを選択し、テストを実行します。</p>
          <p class="warning"><span>Debug As &gt; JUnitテストを使用する必要はありません。すべてのテストは、コンテナ上で実行されていて、すでにデバッグされているからです。</span></p>
          <p>テストは、ブレークポイントで中断されます。JBoss ASであれば、管理コンソールを開き、テストアプリケーションがサーバーにデプロイされていることを確認できます。Eclipseのデバッグビューでスタックトレースを見れば、サーバーはリモートプロトコル（JMXやサーブレット）から制御されていて、JUnitはコンテナ内で実行されていることがわかるでしょう。</p>
          <p><img src="/images/guides/arquillian_tutorial_2_debug_remote_test.png" alt="" /></p>
          <p>これで、サーバーを快適なIDEから操作できるようになりました。</p>
          <h3 id="share">Share the Knowledge</h3>
          <p>Find this guide useful?</p>
          <p class="post_to_twitter"><a href="http://twitter.com/home/?status=Just%20read%20the%20%23Arquillian%20Getting%20Started:%20Rinse%20and%20Repeat%20guide%20and%20got%20a%20%23greenbar!%20Get%20yours.%20http://arquillian.org/guides/getting_started_rinse_and_repeat_ja/"><img src="/images/post_to_twitter.png" alt="" /></a></p>
          <div class="g-plusone" data-size="tall"></div>
          <p>There&#8217;s a lot more about Arquillian to cover. If you&#8217;re ready to learn more, check out the <a href="/guides">other available guides</a>.</p>
          <h4>Feedback</h4>
          <p>Find a bug in the guide? Something missing? You can fix it by <a href="http://github.com/arquillian/arquillian.github.com">forking this website</a>, making the correction and <a href="http://help.github.com/send-pull-requests">sending a pull request</a>. If you&#8217;re just plain stuck, feel free to ask a question in the <a href="http://community.jboss.org/en/arquillian?view=discussions">user discussion forum</a>.</p>
          <h4>Recent Changelog</h4>
          <ul>
            <li>
              Apr 05, 2012:
              Add reference_rev prolog field for translations
              <em>by Dan Allen</em>
            </li>
            <li>
              Apr 05, 2012:
              Use description in prolog for guide summary
              <em>by Dan Allen</em>
            </li>
            <li>
              Feb 10, 2012:
              Identify authors &amp; translators by site identity
              <em>by Dan Allen</em>
            </li>
            <li>
              Jan 30, 2012:
              Add translator field to metadata
              <em>by Dan Allen</em>
            </li>
            <li>
              Jan 29, 2012:
              Add translator as author
              <em>by Takayuki Konishi</em>
            </li>
            <li>
              Jan 29, 2012:
              Japanese translation
              <em>by Takayuki Konishi</em>
            </li>
          </ul>
          <p>
            <a href="https://github.com/arquillian/arquillian.github.com/commits/develop/guides/getting_started_rinse_and_repeat_ja.textile">See full history &raquo;</a>
          </p>
        </div>
        <div id="sidebar">
          <div id="toc">
            <h3 class="chapter_header">Chapters</h3>
            <ol class="chapters">
              <li>
                <a href="#&#21069;&#25552;" id="前提_link">前提</a>
              </li>
              <li>
                <a href="#&#12467;&#12531;&#12509;&#12540;&#12493;&#12531;&#12488;&#12434;&#20316;&#25104;&#12377;&#12427;" id="コンポーネントを作成する_link">コンポーネントを作成する</a>
              </li>
              <li>
                <a href="#&#27573;&#38542;&#30340;&#12395;&#23455;&#35013;&#12377;&#12427;" id="段階的に実装する_link">段階的に実装する</a>
              </li>
              <li>
                <a href="#&#12486;&#12473;&#12488;&#12434;&#26360;&#12367;" id="テストを書く_link">テストを書く</a>
              </li>
              <li>
                <a href="#&#12522;&#12514;&#12540;&#12488;&#12467;&#12531;&#12486;&#12490;&#12434;&#36861;&#21152;&#12377;&#12427;" id="リモートコンテナを追加する_link">リモートコンテナを追加する</a>
              </li>
              <li>
                <a href="#&#12469;&#12540;&#12496;&#12540;&#12434;&#21046;&#24481;&#12377;&#12427;" id="サーバーを制御する_link">サーバーを制御する</a>
              </li>
              <li>
                <a href="#arquillian&#12486;&#12473;&#12488;&#12398;&#23455;&#34892;" id="arquillianテストの実行_link">Arquillianテストの実行</a>
              </li>
              <li>
                <a href="#arquillian&#12486;&#12473;&#12488;&#12398;&#12487;&#12496;&#12483;&#12464;" id="arquillianテストのデバッグ_link">Arquillianテストのデバッグ</a>
              </li>
              <li>
                <a href="#share" id="share_link">Share the Knowledge</a>
              </li>
            </ol>
          </div>
        </div>
        <script>
          $(window).load(function() { activateScrollingToc(['前提', 'コンポーネントを作成する', '段階的に実装する', 'テストを書く', 'リモートコンテナを追加する', 'サーバーを制御する', 'arquillianテストの実行', 'arquillianテストのデバッグ', 'share']) })
        </script>
      </div>
    </div>
    <footer>
      <div class="container">
        <div class="project">
          <img src="/images/arquillian_logo_200px.png" />
          <p class="bottom">
            &#169;
            Copyright 2009-2012 Red Hat, Inc.
            <br />
            <i class="icon-fire"></i>
            Baked by <a href="http://awestruct.org">Awestruct</a>.
            <br />
            <i class="icon-share-alt"></i>
            Website and docs licensed as <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
            <br />
            Code released under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, v2.0</a>.
          </p>
        </div>
        <div class="footer-nav">
          <h4>Learn</h4>
          <ul>
            <li>
              <a href="/invasion">Mission</a>
            </li>
            <li>
              <a href="/features">Features</a>
            </li>
            <li>
              <a href="/guides">Guides</a>
            </li>
            <li>
              <a href="https://docs.jboss.org/author/display/ARQ/Reference+Guide">Manual</a>
            </li>
            <li>
              <a href="http://community.jboss.org/en/arquillian/faq">FAQs</a>
            </li>
          </ul>
        </div>
        <div class="footer-nav">
          <h4>Get Involved</h4>
          <ul>
            <li>
              <a href="http://community.jboss.org/en/arquillian?view=discussions">Forums</a>
            </li>
            <li>
              <a href="https://issues.jboss.org/browse/ARQ">Issue Tracker</a>
            </li>
            <li>
              <a href="https://github.com/arquillian">Source Code</a>
            </li>
            <li>
              <a href="/community/contributors">Contributors</a>
            </li>
            <li>
              <a href="https://commmunity.jboss.org/groups/testing">Testing SIG</a>
            </li>
          </ul>
        </div>
        <div class="sponser">
          <div class="follow-us">
            <h4>Stay Informed</h4>
            <ul>
              <li>
                <a href="https://plus.google.com/100660127586085393031"><img alt="Google+" src="/images/gplus-icon.png" /></a>
              </li>
              <li>
                <a href="https://twitter.com/#!/search/%23arquillian"><img alt="Twitter" src="/images/tw-icon.png" /></a>
              </li>
              <li>
                <a href="http://www.linkedin.com/groups?gid=3120340"><img alt="LinkedIn" src="/images/in-icon.png" /></a>
              </li>
              <li>
                <a href="http://vimeo.com/channels/arquillian"><img alt="Vimeo" src="/images/vimeo-icon.png" /></a>
              </li>
            </ul>
          </div>
          <p>This website is open source! You can also <a href="http://www.seethestats.com/site/arquillian.org">see the stats</a>. If you want to help, <a href="http://github.com/arquillian/arquillian.github.com">fork the project</a> and hack on it.</p>
          <p class="image"><a href="http://jboss.org"><img src="/images/jboss_redhat_branding.png" class="branding" title="Red Hat, Inc." alt="Red Hat, Inc." /></a></p>
          <p>Arquillian is a <a href="http://jboss.org">JBoss Community</a> project and development is sponsored by Red Hat, Inc.</p>
          <p class="bottom"><a href="http://www.redhat.com/legal/legal_statement.html">Terms of Use</a> | <a href="http://www.redhat.com/legal/privacy_statement.html">Privacy Policy</a></p>
        </div>
        <a class="visible-desktop" href="#" id="toTop">Top</a>
      </div>
    </footer>
    <script type="text/javascript">
      //<![CDATA[
        $(function() {
          prettify();
          activateFooterGravity();
          activateTooltips();
          activateToTopControl();
        });
      //]]>
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.0.2/bootstrap.min.js"></script>
    <script src="/javascripts/prettify.js"></script>
    <script src="/javascripts/site.js?4c52ec076c01fb86281d08146616aec64ec1e569"></script>
    <script src="/javascripts/jquery-scroll.js"></script>
    <script src="http://apis.google.com/js/plusone.js"></script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount','UA-18727998-3']);
    _gaq.push(['_trackPageview']);
    (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </body>
</html>
